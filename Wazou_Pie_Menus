bl_info = {
    "name": "Wazou_Pie_Menus",
    "author": "CÃ©dric Lepiller & DavideDozza & Lapineige",
    "version": (0, 1, 1),
    "blender": (2, 71, 4),
    "description": "Custom Pie Menus",
    "category": "3D View",}
    
import bpy
from bpy.types import Menu   
from bpy.props import IntProperty, FloatProperty, BoolProperty


# Brushes Classes
class CreaseBrush(bpy.types.Operator):
    bl_idname = "crease.brush"
    bl_label = "Crease Brush"
    
    def execute(self, context):
        layout = self.layout
        bpy.context.tool_settings.sculpt.brush=bpy.data.brushes['Crease']
        return {'FINISHED'}
    
class ClayBrush(bpy.types.Operator):
    bl_idname = "clay.brush"
    bl_label = "Clay Brush"
    
    def execute(self, context):
        layout = self.layout
        bpy.context.tool_settings.sculpt.brush=bpy.data.brushes['Clay'] 
        return {'FINISHED'}

class InflateBrush(bpy.types.Operator):
    bl_idname = "inflate.brush"
    bl_label = "Inflate Brush"
    
    def execute(self, context):
        layout = self.layout
        bpy.context.tool_settings.sculpt.brush=bpy.data.brushes['Inflate'] 
        return {'FINISHED'}
    
class DrawBrush(bpy.types.Operator):
    bl_idname = "draw.brush"
    bl_label = "Draw Brush"
    
    def execute(self, context):
        layout = self.layout
        bpy.context.tool_settings.sculpt.brush=bpy.data.brushes['Draw'] 
        return {'FINISHED'}

class GrabBrush(bpy.types.Operator):
    bl_idname = "grab.brush"
    bl_label = "Grab Brush"
    
    def execute(self, context):
        layout = self.layout
        bpy.context.tool_settings.sculpt.brush=bpy.data.brushes['Grab'] 
        return {'FINISHED'}

class FlattenBrush(bpy.types.Operator):
    bl_idname = "flatten.brush"
    bl_label = "Flatten Brush"
    
    def execute(self, context):
        layout = self.layout
        bpy.context.tool_settings.sculpt.brush=bpy.data.brushes['Flatten'] 
        return {'FINISHED'}

class MaskBrush(bpy.types.Operator):
    bl_idname = "mask.brush"
    bl_label = "Mask Brush"
    
    def execute(self, context):
        layout = self.layout
        bpy.context.tool_settings.sculpt.brush=bpy.data.brushes['Mask'] 
        return {'FINISHED'}
    
class FillBrush(bpy.types.Operator):
    bl_idname = "fill.brush"
    bl_label = "Fill Brush"
    
    def execute(self, context):
        layout = self.layout
        bpy.context.tool_settings.sculpt.brush=bpy.data.brushes['Fill'] 
        return {'FINISHED'}
          
######################################################

# Define Class Object Mode
class ClassObject(bpy.types.Operator):
    bl_idname = "class.object"
    bl_label = "Class Object"
    
    def execute(self, context):
        layout = self.layout
        
        if bpy.context.object.mode == "OBJECT":
            bpy.ops.object.mode_set(mode="EDIT")
        else:
            bpy.ops.object.mode_set(mode="OBJECT")  
            
            
        return {'FINISHED'}

# Define Class Vertex
class ClassVertex(bpy.types.Operator):
    bl_idname = "class.vertex"
    bl_label = "Class Vertex"
    
    def execute(self, context):
        layout = self.layout
        
        if bpy.context.object.mode != "EDIT":
            bpy.ops.object.mode_set(mode="EDIT")
            bpy.ops.mesh.select_mode(use_extend=False, use_expand=False, type='VERT')
        if bpy.ops.mesh.select_mode != "EDGE, FACE":
            bpy.ops.mesh.select_mode(use_extend=False, use_expand=False, type='VERT') 
            
            return {'FINISHED'}

# Define Class Edge
class ClassEdge(bpy.types.Operator):
    bl_idname = "class.edge"
    bl_label = "Class Edge"
    
    def execute(self, context):
        layout = self.layout
        
        if bpy.context.object.mode != "EDIT":
            bpy.ops.object.mode_set(mode="EDIT")
            bpy.ops.mesh.select_mode(use_extend=False, use_expand=False, type='EDGE')
        if bpy.ops.mesh.select_mode != "VERT, FACE":
            bpy.ops.mesh.select_mode(use_extend=False, use_expand=False, type='EDGE') 
            
            return {'FINISHED'}

# Define Class Face
class ClassFace(bpy.types.Operator):
    bl_idname = "class.face"
    bl_label = "Class Face"
    
    def execute(self, context):
        layout = self.layout
        
        if bpy.context.object.mode != "EDIT":
            bpy.ops.object.mode_set(mode="EDIT")
            bpy.ops.mesh.select_mode(use_extend=False, use_expand=False, type='FACE')
        if bpy.ops.mesh.select_mode != "VERT, EDGE":
            bpy.ops.mesh.select_mode(use_extend=False, use_expand=False, type='FACE') 
            
            return {'FINISHED'}
######################################################        

# Split area horizontal
class SplitHorizontal(bpy.types.Operator):
    bl_idname = "split.horizontal"
    bl_label = "split horizontal"
    
    def execute(self, context):
        layout = self.layout

        bpy.ops.screen.area_split(direction='HORIZONTAL')
        return {'FINISHED'}

# Split area vertical
class SplitVertical(bpy.types.Operator):
    bl_idname = "split.vertical"
    bl_label = "split vertical"
    
    def execute(self, context):
        layout = self.layout

        bpy.ops.screen.area_split(direction='VERTICAL')
        return {'FINISHED'}
        
  
# Join area
class JoinArea(bpy.types.Operator):
    """Join 2 area, clic on the second area to join"""
    bl_idname = "area.joinarea"
    bl_label = "Join Area"

    min_x = IntProperty()
    min_y = IntProperty()

    def modal(self, context, event):
        if event.type == 'LEFTMOUSE':
            self.max_x = event.mouse_x
            self.max_y = event.mouse_y
            bpy.ops.screen.area_join(min_x=self.min_x, min_y=self.min_y, max_x=self.max_x, max_y=self.max_y)
            bpy.ops.screen.screen_full_area()
            bpy.ops.screen.screen_full_area()
            return {'FINISHED'}
        return {'RUNNING_MODAL'}

    def invoke(self, context, event):
        self.min_x = event.mouse_x
        self.min_y = event.mouse_y
        context.window_manager.modal_handler_add(self)
        return {'RUNNING_MODAL'}
    
#View Class menu
class ViewMenu(bpy.types.Operator):
    """Menu to change views"""
    bl_idname = "object.view_menu"
    bl_label = "View_Menu"
    variable = bpy.props.StringProperty()

    @classmethod
    def poll(cls, context):
        return True

    def execute(self, context):
        bpy.context.area.type=self.variable
        return {'FINISHED'} 
    
######################################################   
# Pie Menu Select Mode
class WazouPieMenu(Menu):
    bl_label = "Select Mode"

    def draw(self, context):
        layout = self.layout
           
        ob = context
        if ob.object.type == 'MESH':

            pie = layout.menu_pie()
            pie.operator("class.vertex", text="Vertex", icon='VERTEXSEL')
            pie.operator("class.face", text="Face", icon='FACESEL')
            pie.operator("class.edge", text="Edge", icon='EDGESEL')
            pie.operator("class.object", text="Edit/Object", icon='OBJECT_DATAMODE')
            pie.operator("paint.texture_paint_toggle", text="Texture Paint", icon='WPAINT_HLT')
            pie.operator("sculpt.sculptmode_toggle", text="Sculpt", icon='SCULPTMODE_HLT')
            pie.operator("paint.vertex_paint_toggle", text="Vertex Paint", icon='VPAINT_HLT')
            pie.operator("paint.weight_paint_toggle", text="Weight Paint", icon='WPAINT_HLT')
            
        elif ob.object.type == 'CURVE':
            pie = layout.menu_pie()
            pie.operator("object.editmode_toggle")
            
        elif ob.object.type == 'ARMATURE':
            pie = layout.menu_pie()
            pie.operator("object.editmode_toggle")  
        
        elif ob.object.type == 'FONT':
            pie = layout.menu_pie()
            pie.operator("object.editmode_toggle")      
        
        elif ob.object.type == 'SURFACE':
            pie = layout.menu_pie()
            pie.operator("object.editmode_toggle")  
        
        elif ob.object.type == 'ARMATURE':
            pie = layout.menu_pie()
            pie.operator("object.editmode_toggle")      
        
        elif ob.object.type == 'META':
            pie = layout.menu_pie()
            pie.operator("object.editmode_toggle")  
        
        elif ob.object.type == 'LATTICE':
            pie = layout.menu_pie()
            pie.operator("object.editmode_toggle")
            
        elif ob.object.type == 'ARMATURE':
            pie = layout.menu_pie()
            pie.operator("object.editmode_toggle")        

# View Pie Menu
class WazouViewsPieMenus(Menu):
    # label is displayed at the center of the pie menu.
    bl_label = "Views"
    bl_idname = "scene.views_pie"

    def draw(self, context):
        layout = self.layout

        pie = layout.menu_pie()
        
        #4 - LEFT
        pie.operator("object.view_menu", text="Node Editor", icon= 'NODETREE').variable="NODE_EDITOR"
        #6 - RIGHT
        pie.operator("object.view_menu", text="Image Editor", icon= 'IMAGE_COL').variable="IMAGE_EDITOR"
        #2 - BOTTOM
        pie.operator_context="INVOKE_DEFAULT"
        pie.operator("area.joinarea", icon='X', text="Join Area")
        #8 - TOP
        pie.operator("object.view_menu", text="VIEW 3D", icon= 'VIEW3D').variable="VIEW_3D"
        #7 - TOP - LEFT 
        box = pie.split().column()
        row = box.row(align=True)
        box.operator("object.view_menu", text="Text Editor", icon= 'FILE_TEXT').variable="TEXT_EDITOR" 
        box.operator("object.view_menu", text="Outliner", icon= 'OOPS').variable="OUTLINER" 
        box.operator("object.view_menu", text="Properties", icon= 'BUTS').variable="PROPERTIES"
        box.operator("object.view_menu", text="User Preferences", icon= 'PREFERENCES').variable="USER_PREFERENCES" 
        #box.operator("object.view_menu", text="Movie Clip Editor", icon= 'RENDER_ANIMATION').variable="CLIP_EDITOR"
        #box.operator("object.view_menu", text="Python Console", icon= 'CONSOLE').variable="CONSOLE"
        #box.operator("object.view_menu", text="File Browser", icon= 'FILESEL').variable="FILE_BROWSER"
        #box.operator("object.view_menu", text="Info", icon= 'INFO').variable="INFO"
        #box.operator("object.view_menu", text="Logic Editor", icon= 'LOGIC').variable="LOGIC_EDITOR" 
        #6 - TOP - RIGHT
        box = pie.split().column()
        row = box.row(align=True)
        box.operator("object.view_menu", text="Graph Editor", icon= 'IPO').variable="GRAPH_EDITOR"
        box.operator("object.view_menu", text="Dope Sheet", icon= 'ACTION').variable="DOPESHEET_EDITOR"
        box.operator("object.view_menu", text="Timeline", icon= 'TIME').variable="TIMELINE"
        box.operator("object.view_menu", text="NLA Editor", icon= 'NLA').variable="NLA_EDITOR"
        #box.operator("object.view_menu", text="Sequence Editor", icon= 'SEQUENCE').variable="SEQUENCE_EDITOR"
        #1 - BOTTOM - LEFT
        pie.operator("split.vertical", text="Split Vertical", icon= 'TRIA_RIGHT')
        #3 - BOTTOM - RIGHT
        pie.operator("split.horizontal", text="Split Horizontal", icon= 'TRIA_DOWN')
         


class SculptPieMenu(Menu):
    bl_idname = "sculpt.pie"
    bl_label = "Sculpt Pie Menu"

    def draw(self, context):
        layout = self.layout
        
        pie = layout.menu_pie()
        #4 - LEFT
        pie.operator("crease.brush", text='Crease', icon='BRUSH_CREASE')
        #6 - RIGHT
        pie.operator("clay.brush", text='Clay', icon='BRUSH_CLAY')     
        #2 - BOTTOM
        pie.operator("flatten.brush", text='Flatten', icon='BRUSH_FLATTEN')
        #8 - TOP
        pie.operator("draw.brush", text='Draw', icon='BRUSH_SCULPT_DRAW')
        #7 - TOP - LEFT 
        pie.operator("inflate.brush", text='Inflate', icon='BRUSH_INFLATE')
        #6 - TOP - RIGHT
        pie.operator("grab.brush", text='Grab', icon='BRUSH_GRAB')
        #1 - BOTTOM - LEFT
        pie.operator("mask.brush", text='Mask', icon='BRUSH_MASK')
        #3 - BOTTOM - RIGHT
        pie.operator("fill.brush", text='Fill', icon='BRUSH_FILL')
        
            
addon_keymaps = []

def register():
    # Pie Menu Select Mode
    bpy.utils.register_class(WazouPieMenu)
    bpy.utils.register_class(ClassObject)
    bpy.utils.register_class(ClassVertex)
    bpy.utils.register_class(ClassEdge)
    bpy.utils.register_class(ClassFace)
    #View Menu
    bpy.utils.register_class(WazouViewsPieMenus)
    bpy.utils.register_class(JoinArea)
    bpy.utils.register_class(SplitHorizontal)
    bpy.utils.register_class(SplitVertical)
    bpy.utils.register_class(ViewMenu)
    #Sculpt Pie Menu
    bpy.utils.register_class(SculptPieMenu)
    bpy.utils.register_class(InflateBrush)
    bpy.utils.register_class(ClayBrush)
    bpy.utils.register_class(CreaseBrush)
    bpy.utils.register_class(DrawBrush)
    bpy.utils.register_class(GrabBrush)
    bpy.utils.register_class(FlattenBrush)
    bpy.utils.register_class(MaskBrush)
    bpy.utils.register_class(FillBrush)
    
    wm = bpy.context.window_manager
    
    if wm.keyconfigs.addon:
        #Select Mode
        km = wm.keyconfigs.addon.keymaps.new(name='Object Non-modal')
        kmi = km.keymap_items.new('wm.call_menu_pie', 'TAB', 'PRESS').properties.name = 'WazouPieMenu'
        
        #Views
        km = wm.keyconfigs.addon.keymaps.new(name='Screen')
        kmi = km.keymap_items.new('wm.call_menu_pie', 'SPACE', 'PRESS').properties.name = "scene.views_pie"
        
        #Sculpt Pie Menu
        km = wm.keyconfigs.addon.keymaps.new(name = '3D View Generic', space_type = 'VIEW_3D')
        kmi = km.keymap_items.new('wm.call_menu_pie', 'C', 'PRESS', alt=True).properties.name = "sculpt.pie"
        
        
        addon_keymaps.append(km)


def unregister():
    # Pie Menu Select Mode
    bpy.utils.unregister_class(WazouPieMenu)
    bpy.utils.unregister_class(ClassObject)
    bpy.utils.unregister_class(ClassVertex)
    bpy.utils.unregister_class(ClassEdge)
    bpy.utils.unregister_class(ClassFace)
    #View Menu
    bpy.utils.unregister_class(WazouViewsPieMenus)
    bpy.utils.unregister_class(JoinArea)
    bpy.utils.unregister_class(SplitHorizontal)
    bpy.utils.unregister_class(SplitVertical)
    bpy.utils.unregister_class(ViewMenu)
    #Sculpt Pie Menu
    bpy.utils.unregister_class(SculptPieMenu)
    bpy.utils.unregister_class(InflateBrush)
    bpy.utils.unregister_class(ClayBrush)
    bpy.utils.unregister_class(CreaseBrush)
    bpy.utils.unregister_class(DrawBrush)
    bpy.utils.unregister_class(GrabBrush)
    bpy.utils.unregister_class(FlattenBrush)
    bpy.utils.unregister_class(MaskBrush)
    bpy.utils.unregister_class(FillBrush)
    
    wm = bpy.context.window_manager

    if wm.keyconfigs.addon:
        for km in addon_keymaps:
            for kmi in km.keymap_items:
                km.keymap_items.remove(kmi)

            wm.keyconfigs.addon.keymaps.remove(km)

    # clear the list
    del addon_keymaps[:]

if __name__ == "__main__":
    register()

#bpy.ops.wm.call_menu_pie(name="VIEW3D_PIE_edit")

